const f=["cdn.tailwindcss.com","cdn.jsdelivr.net","unpkg.com","*.oaiusercontent.com","threejs.org"],C=new Set(["https:","http:","wss:"]);function m(e,n=!1){const r=new Set;for(let t of e){if(!t)continue;let s=t.trim();/^(?:https?|wss?):/i.test(s)||(s=`https://${s}`);let o=null;try{o=new URL(s)}catch{if(!n)continue}if(!n&&(!o||!C.has(o.protocol))||o!=null&&o.username||o!=null&&o.password)continue;const c=n?t:o==null?void 0:o.origin;!c||!/^[^\s;,"']+$/.test(c)||r.add(c)}return Array.from(r)}const p=e=>e.filter(Boolean).map(n=>n.startsWith("http")?n:`https://${n}`).join(" ");function L({resourceDomains:e,connectDomains:n=[],isTrusted:r}){const t=p(f.concat(m(e,r))),s=p(f.concat(m(n,r)));return`<meta http-equiv="Content-Security-Policy" content="${["default-src 'self'",`script-src 'self' 'wasm-unsafe-eval' 'unsafe-inline' 'unsafe-eval' blob: ${t}`,"worker-src 'self' blob:",`style-src 'self' 'unsafe-inline' ${t}`,`style-src-elem 'self' 'unsafe-inline' ${t}`,"style-src-attr 'unsafe-inline'",`img-src 'self' data: ${t}`,`font-src 'self' ${t}`,`connect-src 'self' ${s}`,`media-src 'self' data: ${t}`,"object-src 'none'","frame-src 'none'","base-uri 'self'","upgrade-insecure-requests"].filter(Boolean).join("; ")}">`}let d=null,i=null;function S(e){if(!(e!=null&&e.length))return[];if(e.some(r=>r.trim().toLowerCase()==="'none'"))return[];if(e.some(r=>r.trim()==="*"))return["*"];const n=new Set;for(const r of e){const t=r.trim().toLowerCase();t&&n.add(t)}return Array.from(n.values())}function h(e,n){const r=S(e),t=S(n),s=r.includes("*"),o=t.includes("*");if(s&&!o)return"more";if(!s&&o)return"less";if(s&&o)return"equal";const c=new Set(r),a=new Set(t),u=(y,g)=>{for(const b of y)if(!g.has(b))return!1;return!0},l=u(a,c),w=u(c,a);return l&&w?"equal":l&&a.size<c.size?"more":"less"}function $(e,n){if(!e)return"more";let r=!1;const t=h(e.resourceDomains,n.resourceDomains);if(t==="less")return"less";t==="more"&&(r=!0);const s=h(e.connectDomains,n.connectDomains);return s==="less"?"less":(s==="more"&&(r=!0),r?"more":"equal")}function q(e){if(typeof e!="string")return e;const n=document.createElement("div");n.innerHTML=e.trim();const r=n.querySelector('meta[http-equiv="Content-Security-Policy"]');if(!r)throw new Error("buildMetaTag() did not produce a CSP <meta> tag");return r}function v(e){if(!e)return;const n=$(d,e);if(n==="less")throw new Error("CSP is being loosened");if(n==="equal")return;const r=L(e),t=q(r);if(i!=null&&i.isConnected)i.replaceWith(t);else{const s=document.head.querySelector('meta[http-equiv="Content-Security-Policy"]');s?s.replaceWith(t):document.head.appendChild(t)}i=t,d=e}export{v as a};
